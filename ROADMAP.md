# План инженерного исследования для проекта TimelapseBox

## 1. Введение и цели проекта

TimelapseBox – это DIY-система для долгосрочной таймлапс-съёмки, вдохновлённая PhotoSentinel. Основная цель исследования – добиться максимально эстетичного, плавного и кинематографичного таймлапса, который выглядел бы как произведение искусства. Проект состоит из двух частей:
1. Автоматизированная съёмка (RAW+JPG) – камера под управлением Raspberry Pi (через gPhoto2) делает снимки с заданным интервалом.
2. Отложенная обработка – последующая обработка (цветокоррекция, стабилизация, сборка видео через ffmpeg).

Задачи исследования:
- Разработать структуру документации в форме инженерного дневника и технического отчёта.
- Определить метрики качества итогового видео (визуальные и технические) и методику их оценки.
- Исследовать параметры ffmpeg (FPS, CRF, фильтры) для оптимизации качества видео.
- Оценить надёжность системы и предложить способы повышения устойчивости.
- Проанализировать энергоэффективность различных конфигураций TimelapseBox.
- Сформулировать предложения по возможным аппаратным и программным улучшениям проекта.
- Дать рекомендации по структуре репозитория, презентации и итогового отчёта.

## 2. Структура документации (инженерный дневник и технический отчёт)

Документация проекта оформляется в двух форматах:
- **Инженерный дневник** – хронологическое описание процесса разработки и экспериментов. В нём фиксируются дата и время, цель каждого шага, применённые изменения настроек, наблюдения и промежуточные выводы.
- **Технический отчёт** – структурированный документ, обобщающий итоги работы. Он будет включать:
  - Введение (постановка задачи, обзор TimelapseBox и цели)
  - Описание системы (аппаратная схема и программная архитектура)
  - Методика исследований
  - Результаты и их анализ
  - Обсуждение
  - Выводы
  - Будущие улучшения
  - Приложения
  - Список источников

Связь дневника и отчёта: Инженерный дневник служит первичным местом накопления данных и выводов. На его основе формируется отчёт – более сжатый и организованный. В репозитории проекта эти документы будут храниться в каталоге /docs.

## 3. Метрики качества итогового видео

Для оценки качества таймлапса будем использовать следующие метрики:

- **Плавность движения** – характеризует, насколько ровно и непрерывно объекты перемещаются в видео. Плавность обеспечивается правильным соотношением выдержки и интервала.
- **Отсутствие мерцания (flicker)** – мерцание экспозиции или баланса белого между кадрами сильно портит впечатление. Цель – минимизировать flicker до незаметного уровня.
- **Динамический диапазон и контраст** – эстетичность кадра зависит от того, насколько хорошо проработаны тени и света, нет ли провалов или засветов.
- **Цветовая стабильность и эстетика цвета** – отсутствие цветового дрожания, приятная цветовая гамма.
- **Чёткость и детализация vs шум** – видео не должно быть пере-шарпленным или размытым, кроме случаев художественного приёма.
- **Стабильность кадра** – отсутствие дрожания, если камера была не идеально стационарна.
- **Технические метрики видео** – разрешение (4K), битрейт (через CRF), цветовое пространство (Rec.709, 8-bit).

## 4. Анализ параметров камеры, влияющих на эстетику таймлапса

### 4.1 Формат съёмки: RAW vs JPEG
- Съёмка в RAW сохраняет больше деталей и динамический диапазон, что критично при дальнейшей цветокоррекции.
- Камера настроена с одновременным сохранением RAW+JPEG. JPEG нужны для оперативного превью.

### 4.2 Разрешение и соотношение сторон кадров
- Выбирается максимальное разрешение камеры для возможности формирования таймлапсов вплоть до 8K.
- Оптимальная диафрагма (около f/8) для максимальной резкости.
- Высокое разрешение позволяет делать искусственное движение камеры при постобработке.

### 4.3 Выдержка и интервал съёмки
- Для плавного движения выдержка должна быть достаточно длинной (1-2 секунды для дневных таймлапсов).
- Использование ND-фильтров при ярком дневном свете.
- Интервал между кадрами выбирается исходя из скорости происходящего и желаемой длины видео.
- Желательно, чтобы выдержка была не больше половины интервала.

### 4.4 Диафрагма (апертура) и глубина резкости
- Днём съёмка на средне-закрытой диафрагме (около f/8) для максимальной резкости и достаточной глубины резкости.
- Ночью – максимально открытая диафрагма (f/2.8) для пропускания большего количества света.
- Решение проблемы мерцания диафрагмы: использование объектива с ручным управлением или фиксация диафрагмы.

### 4.5 ISO и шумоподавление
- Держать ISO минимально возможным для данной сцены.
- При дневной съёмке – ISO 100, в сумерках и ночью – повышать по необходимости.
- Выключение встроенных функций шумоподавления камеры для ускорения процесса съёмки.

### 4.6 Баланс белого и профиль изображения
- Настройка баланса белого вручную и фиксация для предотвращения цветовых сдвигов между кадрами.
- Использование нейтрального профиля изображения для JPEG.
- Отключение автофокуса, стабилизатора изображения и других автоматических функций.

## 5. Анализ параметров ffmpeg и пост-обработки

### 5.1 Частота кадров (FPS) и скорость воспроизведения
- Выбор частоты 24 кадра/с для кинематографичности.
- Возможность варьирования скорости внутри ролика для акцентирования определённых изменений.

### 5.2 Видео-кодек и качество (CRF, битрейт)
- Использование кодека H.264 (libx264) в контейнере MP4.
- CRF ~18 для высокого качества (визуально без потерь).
- Разрешение видео: 4K UHD (3840×2160).
- Цветовое пространство: Rec.709 (yuv420p для совместимости).

### 5.3 Стабилизация изображения
- Использование встроенной возможности ffmpeg + VidStab для устранения дрожания.
- Процесс стабилизации: анализ движения и применение обратных сдвигов.
- Автоматическое зумирование для скрытия чёрных краёв после стабилизации.

### 5.4 Фильтры для цветокоррекции и художественных эффектов
- Применение LUT (Look-Up Table) для задания определённого кинематографического вида.
- Использование фильтров curves, hue для цветокоррекции.
- Виньетирование для фокусировки внимания на центре кадра.
- Возможное добавление лёгкой резкости или зерна для художественного эффекта.

### 5.5 Отложенная обработка и автоматизация конвейера
- Обработка на устройстве или на ПК после выгрузки кадров.
- Автоматизация процесса через скрипты и конфигурационные файлы.
- Возможность генерации превью видео для быстрого просмотра.

## 6. Надёжность системы (устойчивость и отказоустойчивость)

Потенциальные проблемы надежности:
- Прерывание съёмки из-за программного сбоя
- Зависание камеры
- Перегрузка памяти или хранилища
- Сбой питания
- Экстремальные условия среды
- Аппаратный отказ

Меры повышения надежности:
- Watchdog (программный и аппаратный)
- Авто-реинициализация камеры
- Тесты на длительную работу
- Отказоустойчивое питание
- Безопасное завершение работы
- Регулярное обслуживание

## 7. Энергоэффективность и питание системы

- Измерение потребления тока на различных этапах работы.
- Выбор аппаратной платформы с учётом энергопотребления (Raspberry Pi Zero W для максимальной экономии).
- Энергосберегающие стратегии: режим сна, отключение периферии, понижение тактовой частоты.
- Расчёт автономной работы от солнечных панелей и аккумуляторов.
- Конфигурации для минимального потребления и для максимальной производительности.

## 8. Возможные улучшения аппаратной части

- Использование камеры с большим сенсором для лучшего качества ночных кадров.
- Улучшенная оптика: объектив с механической диафрагмой, большой светосилой.
- Моторизированные фильтры для автоматической адаптации к условиям освещения.
- Система движения камеры (панорамная головка или слайдер).
- Усиленная защита от внешних условий: герметичный корпус, обогрев стекла, вентиляция.
- Аппаратный мониторинг: датчики напряжения, температуры, влажности.
- Улучшенное питание: MPPT контроллер для солнечной панели, переключение источников.

## 9. Возможные улучшения программной части

- Интеллектуальное управление экспозицией для плавного перехода день-ночь.
- Автоматическое устранение мерцания на устройстве.
- Web-интерфейс для мониторинга и управления.
- Облачная интеграция для загрузки фотографий или готовых видео.
- Аналитика кадров для обнаружения проблем (закрытие объектива, смещение камеры).
- Сжатие данных на лету для экономии места и ускорения передачи.
- Развитие open-source сообщества вокруг проекта.

## 10. Рекомендации по структуре репозитория, презентации и итогового отчёта

### Структура репозитория (GitHub):
- README.md – главная страница с описанием проекта
- ROADMAP.md – список задач
- /docs/ – папка с документацией
- /src/ – исходный код
- /scripts/ – утилиты
- /config/ – файлы конфигурации
- /examples/ – примеры
- LICENSE.txt – лицензия
- Contributing.md – правила для внешнего вклада

### Презентация (слайды):
- Титульный слайд
- Проблема и цель
- Система TimelapseBox
- Методика исследования
- Качество изображения (результаты)
- Параметры обработки (результаты)
- Надёжность и автономность
- Демонстрация результата
- Выводы
- Следующие шаги
- Благодарности/Контакты

### Итоговый PDF-отчёт:
- Включает все детали исследований
- Содержит иллюстрации, графики, таблицы
- Оформленный список литературы
- Приложения с техническими деталями
- Структурирован по разделам 3-9
- Доступен для понимания как техническими специалистами, так и менее подкованными читателями