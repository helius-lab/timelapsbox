7. Энергоэффективность (анализ и оптимизация энергопотребления)

Если TimelapseBox предполагается использовать в полевых условиях (вдали от электросети, на батарее/солнечной панели), энергоэффективность становится критичным фактором. В этом разделе исследуем энергопотребление различных конфигураций и режимов и предложим оптимизации, позволяющие дольше работать автономно.
• Замер текущего потребления: Сначала, мы проведём измерения:
• Потребление Raspberry Pi + камера в режиме ожидания ￼мками).
• Потребление в момент съёмки (камера активна, Pi пишет на диск).
• Потребление при обработке (если ffmpeg видео рендер запущен).
Например, используя USB-поверметр или мультиметр в разрыв питания, измерим ток. Допустим, Raspberry Pi 4 Model B обычно ~600 мА (3 Вт) в idle, камера DSLR в standby ~2–3 Вт, итого ~5–6 Вт непрерывно. За сутки это ~120–144 Вт·ч. Для павербанка 20 000 мА·ч (~74 Вт·ч) хватит лишь ~12 часов ￼. Это при непрерывной работе. Мы должны подтвердить цифры и затем искать, как уменьшить.
• Выбор вычислительной платформы:
• Raspberry Pi 4 – самый мощный, но и самый прожорливый. Если задействовать его CPU (ffmpeg) часто, он съест больше энергии (до 7–8 Вт под полной нагрузкой).
• Raspberry Pi Zero W – намного экономичнее, ~120–180 мА (0.6–0.9 Вт) без нагрузки. Без Wi-Fi ещё чуть меньше ￼. Однако Pi Zero не потянет тяжелую обработку быстро. Но съемку и отсылку данных – вполне. Возможно, гибридный подход: использовать Pi4 только при наличии внешнего питания, а для сугубо автономного – перейти на Pi Zero (с отказом от локального рендеринга, только съемка и отправка кадров).
• Другие: ESP32 или Arduino для интервалометра почти нулевого потребления – но они не могут контролировать DSLR так просто и не могут отправлять RAW. Поэтому Pi Zero – минимальное решение.
Мы оценим конфигурации: 1. Pi4 + DSLR (максимум возможностей, минимум компромиссов в софте, но высокий расход). 2. Pi Zero + DSLR (ограниченный софт, возможно без местного ffmpeg, но большой выигрыш в потреблении – экономичнее). 3. Возможный промежуточный – Pi3A+ (1 core, нет ethernet, меньше потребление, но можно USB).
Вывод: предложим вариант TimelapseBox Lite на Pi Zero для долгих автономных съёмок. И укажем, что Zero W потребляет чуть больше за счёт Wi-Fi ￼, так что если не нужен постоянный Wi-Fi, лучше отключить (или использовать Zero без W).
• Wi-Fi / 4G модули:
• Беспроводная связь может быть энергозатратной, особенно 4G модемы (они могут потреблять сотни мА в пик). Чтобы экономить, можно отключать модем большую часть времени и включать раз в сутки для передачи данных.
• Raspberry Pi Wi-Fi ￼льзуем, выключить rfkill. Это сэкономит ~50 мА ￼. Bluetooth тоже отключить.
• Сон интерфейсов: у Raspberry Pi нет полноценного sleep, но можно менеджить CPU freq (частота процессора понизится при простое) и выключить HDMI выход (пара сотен мВт экономии).
• Duty Cycle работы: Очевидно, не снимать чаще, чем нужно. Если проект позволяет, увеличить интервал между сни ￼ционально экономится заряд (камера реже включается, Pi меньше пишет). Например, снимать раз в час растение – тогда остальное время Pi можно даже выключить.
• Мы рассмотрим включение/выключение Pi по расписанию. Есть проект, где Pi питается через OnOff Shim, управляющий Attiny-контроллером, который будит Pi только для снимка ￼. Там добил ￼бления в спящем режиме (!) и включения Pi на 60 секунд в день ￼. Это экстремальный, но очень поучительный пример: мы можем взять его на вооружение.
• Для нашей цели (плавный таймлапс) часто нужно чаще снимать чем 1 раз в день, но принцип можно масштабировать: например, будить каждый час. Тогда Pi большую часть часа выключен (потребление ~0), проснулся – сделал 1–2 минуты работу – обратно спать. Энерговыгода огромна.
• Минус: усложнение схемы и риск того, что частые on/off могут повлиять на SD (но если корректно через OnOff Shim – нормально).
• Питание камеры: DSLR обычно питается собственной батареей ~7.4V. Мы можем питать её от основной батареи через DC-DC. В плане энергии:
• Если камера остаётся включённой всё время, она сама может потреблять 1–2 Вт даже в idle (для поддержания сенсоров, дисплея отключенного, но электроника работает). Возможно, программно отключать камеру между кадрами. Например, некоторым камерам можно отправить команду отключиться, а затем включить через инфракрасный порт или механически. Не всегда доступно.
• Если не можем выключать камеру, можем хотя бы авто-спящий режим камеры: через, скажем, 1 минуту простоя она сама спит. Но тогда gPhoto2, чтобы сделать снимок, должен её разбудить (обычно полу-нажатием, что тоже можно послать).
• Сменные аккумуляторы: если в поле, придётся либо иметь солнечную зарядку, либо менять аккум вручную. Энергоанализ для камеры: скажем, батарея 2000 mAh, 7.4 V = ~14.8 Wh. Если камера потребляет 1 Вт в sleep, то за ~15 ч разрядит. Но если она в глубоком sleep, то может держать дни. Мы изучим мануал камеры, как лучше.
• Солнечное питание: Предположим, TimelapseBox питается от солнечной панели + аккумулятора. Тогда важно баланс потребления и генерации. Мы можем сделать расчет в отчёте:
• Потребление в сутки, например 42 Wh (как кто-то рассчитал на форуме для Pi time-lapse) ￼.
• Средняя дневная генерация нужной панели: допустим, 20 Вт панель в летний день даст ~100 Wh. Этого может хватить на 42 Wh в сутки с запасом. Но зимой или в пасмурный день уже нет.
• Такую оценку приведём, мол для круглогодичного питания нужна солнечная панель >50 Вт и аккумулятор на несколько дней, или очень сильное энергосбережение.
• Опять же, ￼ие работы** (спящий режим) – ключ. Если коробка должна прожить без солнца, скажем, 5 дней, а потребление 0.1 Вт в спящем режиме – за 5 дней ~12 Wh, что малый аккумулятор обеспечит. Если 5 Вт постоянно – 5 дней = 600 Wh, нужен огромный аккумулятор.
• Конкретные измерения/оптимизации:
• Выключим HDMI, LEDs на Pi (сэкономим мелочь, но в отчёте упомянем).
• CPU governor: поставим powersave, чтобы частота CPU минимальная вне съёмк ￼трим, можно ли отключать USB порт, когда не нужен (сложно, т.к. камера висит на USB; но если между кадрами долго, может можно рубить питание USB через hub with power control?).
• Pi Zero vs Pi4: Если удастся, протестируем оба: сколько потребляет Pi Zero при съемке. Вероятно, разница: Pi4 ~5 В _ 0.5 A = 2.5 Вт idle, Pi0 ~5 В _ 0.12 A = 0.6 Вт. Это >4х раз меньше. Учитывая, что камера всё равно ест, но Pi Zero выигрыш видим.
• Метрики энергоэффективности:
• Вт·ч на один кадр: интересная метрика – сколько энергии тратится на получение одного фото. Если Pi всегда включён, а кадры редкие, метрика большая. Если Pi включается только на съёмку – метрика приближается к энергии самой съемки. Мы можем рассчитать для разных сценариев и привести в отчёте.
• Часы работы от батареи N: например, от 20 000 mAh powerbank. С конфигурацией A (Pi4, continuous) – ~1 день ￼. С конфигурацией B (Pi0, sleep cycles) – возможно недели.
• Коэффициент использования: доля времени, когда система активно что-то делает vs спит. Чем меньше, тем лучше для энергии.
• Выбор оптимальной конфигурации:
• Если цель – максимальное качество (RAW обработка на месте), придётся смириться с более высоким расходом или подключение к сети.
• Если цель – долгая автономность, можно пожертвовать локальной обработкой: сохранять RAW на SD, а Pi большую часть времени спит. Обработка – после того, как заберём SD.
• Можно предусмотреть два режима TimelapseBox: “Performance” и “Low-power”. В отчёте это предложим: режим Performance – Pi4, быстрый рендер, Wi-Fi uploads; режим Low-power – Pi0, минимальная активность, только сбор данных.
• Реализация аппаратных улучшений для энергии:
• Микроконтроллерный таймер (Attiny85, как у упомянутого автора ￼).
• OnOff Shim (готовый модуль для мягкого выключения Pi) – у нас уже в списке оборудования упомянут ￼.
• Возможность **солнечной за ￼ользовать контроллер типа MPPT, чтобы эффективно заряжать.
• \*\*Дублирование питани ￼етуют, лучше 2 источника параллельно (сетевое и солнечное + батарея) ￼, чтобы повышало надёжность.

В отчёте раздел энергоэффективности представим и в виде количественных данных (измеренное потребление, расчет времени от аккумулятора), и как рекомендации (выключить то-то, использовать Pi Zero и т.п.). Например, включим цитату: ”Mi ￼ut 5 mA when sleeping… If you only power up a couple of times per day…” – т.е. реально достижим очень малый ток в спящем режиме при грамотном подходе ￼. Это покажет, что мы искали лучшие решения.
